(function(){function t(b){b=$(b).closest(":has([fragmentjs])");b=s(b);null!=b&&b.RefreshFragment?b.RefreshFragment():(b=c.AjaxNavStack[c.AjaxNavStack.length-1])&&null!=b.RefreshUrl&&v(null,null,{"ajax-url":b.RefreshUrl,"ajax-update":b.UpdateTargetId})}function w(b,e){var a=$(b).closest(":has([fragmentjs])"),a=s(a);null!=a&&a.BackFragment&&(e=a.BackFragment());if("undefined"==typeof e||null==e)e=!0;a=c.AjaxNavStack.pop();$(a.UpdateTargetId).empty();$(a.UpdateTargetId).append(a.Fragment);a=$(a.UpdateTargetId);
a=s(a);e&&(a&&a.RefreshFragment?a.RefreshFragment():t())}function x(){for(var b;b=c.Html_Load_Queue.shift();)b.Func.apply(b.Context,arguments)}function y(){$("form[data-ajax-url*="+c.AjaxFormIdentifierName+"]").each(function(){var b=$(this).attr("data-ajax-url"),e=b.indexOf(c.AjaxFormIdentifierName),a=b.indexOf("&",e);0>a&&(a=b.length-1);e=b.substring(e,a+1);b="&"==b.substr(b.indexOf(c.AjaxFormIdentifierName)-1,1)?b.replace("&"+e,""):b.replace(e,"");$(this).attr("data-ajax-url",b);e=e.replace("&",
"");$(this).attr(e.split("=")[0],e.split("=")[1])})}function z(b){$("form[data-ajax-url]",b).each(function(){$(this).attr("data-ajax","true");"undefined"==typeof $(this).attr("data-ajax-loading")&&$(this).attr("data-ajax-loading","#divProcessing");"undefined"==typeof $(this).attr("data-ajax-mode")&&$(this).attr("data-ajax-mode","before");"undefined"==typeof $(this).attr("data-ajax-method")&&("undefined"!=typeof $(this).attr("method")?$(this).attr("data-ajax-method",$(this).attr("method")):$(this).attr("data-ajax-method",
"post"));"undefined"==typeof $(this).attr("ajax-modelonly")&&("undefined"==typeof $(this).attr("data-ajax-update")?$(this).attr("ajax-modelonly","true"):$(this).attr("ajax-modelonly","false"))});$("[ajax-url='']",b).attr("ajax-url",function(){return $(this).closest("form").attr("data-ajax-url")});$("[ajax-url][ajax-update='']",b).each(function(){var b=$(this).closest("form").attr("data-ajax-update");"undefined"!=typeof b&&""!=b?$(this).attr("ajax-update",b):$(this).removeAttr("ajax-update")});C(b)}
function C(b){var e=function(a){v(this);a.preventDefault()};$("button[ajax-url]:not([ng-click]),a[ajax-url]:not([ng-click])",b).each(function(){!0!=this.ClickBinded&&(this.ClickBinded=!0,$(this).click(e))});$('select[ajax-url][IsMasterList="true"]:not([ng-click])',b).each(function(){!0!=this.ChangeBinded&&($(this).change(function(){v(this,this.name.substring(this.name.lastIndexOf(".")+1,this.name.length)+"="+$(this).val())}),this.ChangeBinded=!0)})}function A(b,e){if("undefined"==typeof b)return"undefined"==
typeof e?"":e;if("undefined"==typeof e)return b;if(""==b||""==e)return b+e;for(var a=b.split("&"),k=e.split("&"),c="",f="",d="",h=0;h<k.length;h++){for(var g=k[h].split("="),r=!1,n=0;n<a.length;n++)if(a[n].split("=")[0].toLowerCase()==g[0].toLowerCase()){a[n]=k[h];r=!0;break}r||""==k[h]||(d=d+k[h]+"&")}for(h=0;h<a.length;h++)f=f+a[h]+"&";f.endWith("&")&&(c=f);d.endWith("&")&&(c+=d);c.endWith("&")&&(c=c.substr(0,c.length-1));return c}function v(b,e,a,k,m,f){var d,h,g,r,n,p,l;null==b&&(b=void 0);if("string"==
$.type(b)){if(!b.startWith("#")){alert('string param "control" should be an string id prefixed with #');return}b=$(b);if(1<b.lengh){alert('first param "control" evals to more then one control! ');return}}a&&a["ajax-form"]&&(d=$("#"+a["ajax-form"]));a&&a["ajax-url"]&&(h=a["ajax-url"]);a&&"undefined"!=typeof a["ajax-update"]&&(g=a["ajax-update"]);a&&"undefined"!=typeof a["ajax-bind"]&&(r=a["ajax-bind"]);a&&"undefined"!=typeof a["ajax-processing"]&&(n=a["ajax-processing"]);a&&"undefined"!=typeof a["ajax-nav"]&&
(p=a["ajax-nav"]);a&&a["ajax-modelonly"]&&(l=a["ajax-modelonly"]);"undefined"==typeof r&&(r=$(b).attr("ajax-bind"));"undefined"==typeof n&&(n=$(b).attr("ajax-processing"));"undefined"==typeof l&&(l=$(b).attr("ajax-modelonly"));if(void 0==e||null==e)e="";if("undefined"==typeof d)if("undefined"==typeof b)d=B();else if($(b).is("form"))d=$(b);else{var q=$(b).attr("ajax-form");if("undefined"!=typeof q)if(""==q)d=B();else{if(d=$("#"+q),0==d.length){alert("form not found,id="+q);return}}else if(d=$(b).closest("form"),
!d){alert("need form!");return}}q=d.attr(c.AjaxFormIdentifierName);if("undefined"!=typeof c.AjaxFormSyncLock_Dict[q])window.setTimeout(function(){v(b,e,a,k,m,f)},100);else{var s=d.attr("data-ajax-url"),t=d.attr("data-ajax-update");if("undefined"==typeof h||""==h)h="undefined"!=typeof b?$(b).is("form")?$(b).attr("data-ajax-url"):$(b).attr("ajax-url"):d.attr("data-ajax-url");if("undefined"==typeof h||""==h)return alert("need value for ajax-url!");"undefined"==typeof g&&(g=$(b).attr("ajax-update"));
"undefined"==typeof g&&(g=d.attr("data-ajax-update"));"undefined"!=typeof g&&(null==g?d.removeAttr("data-ajax-update"):("parent"==g&&(g=d.attr("ajax-update-parent"),"undefined"!=typeof g&&""!=g||"undefined"==typeof b||(g=$(b).closest("form").attr("ajax-update-parent")),"undefined"==typeof g||""==g)&&($("body",document).eq(0).attr("id","theBody"),g="theBody"),g.startWith("#")?d.attr("data-ajax-update",g):d.attr("data-ajax-update","#"+g)));g=d.attr("data-ajax-update");"undefined"!=typeof g&&(g=g.substr(1,
g.length));var w=h.split("?")[0],u=h.split("?")[1],u=A(u,e);"undefined"==typeof l&&(l="undefined"==typeof g&&"undefined"!=typeof r?"true":0>h.indexOf(c.KeyForViewModelOnly)&&0<d.attr("data-ajax-url").indexOf(c.KeyForViewModelOnly+"=true")?"true":"false");u=A(u,c.KeyForViewModelOnly+"="+l);"true"==l&&(d.removeAttr("data-ajax-update"),g=void 0);h=w+(""==u?"":"?"+u);d.attr("data-ajax-url",h);"undefined"==typeof p&&(p=$(b).attr("ajax-nav"));l=!1!=k?"true":"false";"undefined"==typeof n&&("undefined"!=
typeof d.attr("_ajaxformidentifier")?n="_formid="+d.attr("_ajaxformidentifier"):"undefined"!=typeof d.attr("id")&&(n="_formid="+d.attr("id")));d.attr("data-ajax-begin",c.ProjectBaseJsPackageNamePrefix+"CommonOnBeginAjaxForm(xhr,'"+q+"',"+("undefined"==typeof g?"undefined":"'"+g+"'")+","+("undefined"==typeof r?"undefined":"'"+r+"'")+","+("undefined"==typeof n?"undefined":"'"+n+"'")+")");d.attr("data-ajax-complete",c.ProjectBaseJsPackageNamePrefix+"CommonOnCompleteAjaxForm(xhr,status,'"+q+"',"+("undefined"==
typeof g?"undefined":"'"+g+"'")+","+("undefined"==typeof r?"undefined":"'"+r+"'")+","+l+","+("undefined"==typeof p?"undefined":"'"+p+":"+h+"'")+","+("undefined"==typeof m?"undefined":m.toString())+","+("undefined"==typeof f?"undefined":"'"+f+"'")+")");d.attr("data-ajax-success",c.ProjectBaseJsPackageNamePrefix+"CommonOnSuccessAjaxForm('"+q+"',"+("undefined"==typeof t?"undefined":"'"+t+"'")+")");$("#MessageLine").hide();d.submit();s?d.attr("data-ajax-url",s):d.removeAttr("data-ajax-url")}}function B(){var b=
"<form id='"+c.ImplicitFormId+"' data-ajax='true' data-ajax-url='' data-ajax-loading='#divProcessing' data-ajax-mode='before' data-ajax-method='post' "+c.AjaxFormIdentifierName+"='"+c.ImplicitFormId+"'></form>";0==$("#"+c.ImplicitFormId).length?$(b).appendTo($("body")):$("#"+c.ImplicitFormId).replaceWith(b);return $("#"+c.ImplicitFormId)}function s(b,e){var a;e&&(a=$(b).attr("fragmentjs"));"undefined"==typeof a&&(a=$("[fragmentjs]",b),0<a.length&&(a=a.eq(0).attr("fragmentjs")));try{return eval(a)}catch(k){return null}}
function D(b,e){var jsonObj=b;evalIgnoreCase=function(a,b){try{value=eval(a+b)}catch(e){var c=b.split("."),d="";for(i=0;i<c.length;i++)d=d+"."+c[i].substring(0,1).toLowerCase()+c[i].substring(1);value=eval(a+d.substring(1))}"undefined"==typeof value&&(value=eval(a+b.substring(0,1).toLowerCase()+b.substring(1)));return value};$("[name]",e).each(function(){var a,c=this.getAttribute("name");try{"._Display"==c.substr(c.length-9,9)?(a=evalIgnoreCase("jsonObj.ViewModelDisplay.",c.substr(0,c.lastIndexOf("._"))),"undefined"==
typeof a&&(a=evalIgnoreCase("jsonObj.ViewModel.",c.substr(0,c.lastIndexOf("._"))))):a=evalIgnoreCase("jsonObj.ViewModel.",c),"undefined"==typeof a&&(a=eval("jsonObj.RouteValues."+c)),"undefined"==typeof a&&(a=eval("jsonObj.QueryString."+c))}catch(e){a=b[c]?b[c]:null}if("undefined"!=typeof a){null==a&&(a="");if((c.endWith("Date")||c.endWith("Time"))&&1E12<parseInt(a)){a=new Date(parseInt(a));var f=a.getMonth()+1,d=a.getDate();a=a.getFullYear()+"-"+(10>f?"0"+f:f)+"-"+(10>d?"0"+d:d)}f=$(this).prop("tagName");
if("INPUT"==f||"SELECT"==f||"TEXTAREA"==f)if("checkbox"==this.type||"radio"==this.type)this.checked=this.value.toLowerCase()==a.toString().toLowerCase();else{if("hidden"!=this.type||"_"+$(this).prev().attr("name")!=c||"checkbox"!=$(this).prev().attr("type"))c=$(this).val(),$(this).val(a),("INPUT"==f&&"text"==this.type||"SELECT"==f||"TEXTAREA"==f)&&c!=a&&$(this).triggerHandler("change","ByModelBinding")}else $(this).text(a)}})}var c={DefaultPopupWindowFeature:"height=600, width=600, top=50, left=300, toolbar=yes, menubar=no, scrollbars=yes, resizable=yes,location=no, status=no",
AuthFailure:"_AuthFailure",AuthFailureMaskElementId:"divAuthFailureMask",AjaxFormIdentifierName:"_ajaxformidentifier",KeyForViewModelOnly:"_ForViewModelOnly",ImplicitFormId:"_ImplicitForm",AjaxNavStack:[],Html_Load_Queue:[],AjaxFormSyncLock_Dict:{},ProjectBaseJsPackageNamePrefix:"pb_"},p=ProjectBase_WebClientAppRoot.pbDefaultService;p.ProjectBaseGlobalVar=c;p.AjaxSubmit=v;p.Validate=function(b){b=$(b).data("unobtrusiveValidation");return!b||!b.validate||b.validate()};p.AjaxNavRefresh=t;p.AjaxNavBack=
w;p.CloseFragment=function(){w()};p.AjaxGetJson=function(b,c){$.getJSON(b,c)};p.CommonOnBeginAjaxForm=function(b,e,a,k,m){b=null;"undefined"!=typeof a&&""!=a?("#"!=a.substr(0,1)&&(a="#"+a),0<$(a).length&&(b=$(a).eq(0))):"undefined"!=typeof k&&""!=k&&("#"!=k.substr(0,1)&&(k="#"+k),0<$(k).length&&(b=$(k).eq(0)));p.PutProcessing(b,m);$(".validation-summary-errors").addClass("validation-summary-valid").removeClass("validation-summary-errors");$(".field-validation-error").addClass("field-validation-valid").removeClass("field-validation-error");
$(".input-validation-error").addClass("valid").removeClass("input-validation-error");$("#MessageLine").html("");c.AjaxFormSyncLock_Dict[e]=1};p.CommonOnCompleteAjaxForm=function(b,e,a,k,m,f,d,h,g){delete c.AjaxFormSyncLock_Dict[a];var p;a=null;"undefined"!=typeof k&&""!=k&&(0<=k.indexOf(":")?(a=k.split(":"),p=a[0],k=a[1],a=null):("#"!=k.substr(0,1)&&(k="#"+k),0<$(k).length&&(a=$(k).eq(0))));var n=null;try{n=$.parseJSON(b.responseText)}catch(t){}if(n){var l,q;b=document;"undefined"!=typeof m&&""!=
m&&("#"!=m.substr(0,1)&&(m="#"+m),0<$(m).length&&(b=$(m).eq(0)),l=s(b));a=!1;m=$("#"+c.AuthFailureMaskElementId);m.hide();n==c.AuthFailure?(0==m.length&&(m=$('<div id="'+c.AuthFailureMaskElementId+'" style="position: absolute;z-index:100;background-color:#ffffff;display:none;" tabindex=1/>').appendTo($(b))),ShowMask(m,$(b)),m.load(App_Common.AuthFaliureUrl)):(l&&void 0!=l.Model_Binding&&(q=l.Model_Binding(n)),!1!=f&&!1!=q&&(D(n,b),l&&void 0!=l.Model_Binded&&l.Model_Binded(n),a=!0));h&&h(g,a,n)}else"success"==
e?-1!=(b.getResponseHeader("Content-Type")||"text/html").indexOf("application/x-javascript")?h&&h(g,!1,b.responseText):null!=a?(f=k,l=d,"undefined"==typeof l?$(f).children().eq(1).remove():(q=l.split(":"),l=q[0],q=q[1],m={UpdateTargetId:f,Fragment:$(f).children().eq(1).detach(),RefreshUrl:q},"root"==l?c.AjaxNavStack=[{UpdateTargetId:f,Fragment:$('<div class="Page"><span class="displaynone">\u6b22\u8fce\u4f7f\u7528\u62a5\u5173\u7ba1\u7406\u7cfb\u7edf\uff01</span></div>'),RefreshUrl:q}]:"forward"==
l?c.AjaxNavStack.push(m):alert("nav has invalid value!")),f=a,y(),$("form",f).attr("ajax-update-parent",f.attr("id")),(a=s(f))&&void 0!=a.Html_Load&&a.Html_Load(f),x(),void 0!=window.AddUICommon&&window.AddUICommon(f),z(f),$.validator.unobtrusive.parse(f),a&&void 0!=a.UI_Ready&&a.UI_Ready(f),h&&h(g,null,b.responseText)):(0<=b.responseText.indexOf(c.AuthFailure)&&window.alert($(b.responseText).text()),null!=p&&(f=window.open("",p,c.DefaultPopupWindowFeature),f.document.write(b.responseText),f.document.close()),
h&&h(g,!1,b.responseText)):(null==a&&(a=$("body")),a.html(e+" : "+b.responseText))};p.CommonOnSuccessAjaxForm=function(b,e){var a=$("form["+c.AjaxFormIdentifierName+"="+b+"]");e?a.attr("data-ajax-update",e):a.removeAttr("data-ajax-update");delete c.AjaxFormSyncLock_Dict[b]};$(function(){y();void 0!=window.Document_Load&&window.Document_Load();x();void 0!=window.AddUICommon&&window.AddUICommon(document);z(document);void 0!=window.UI_Ready&&window.UI_Ready(document);$("#divLoadingPage").hide()})})();
