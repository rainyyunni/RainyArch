(function(l,g){var h=g.module("projectbase","ui.router ui.bootstrap jcs-autoValidate pascalprecht.translate ngCookies ngAnimate".split(" "));h.controller("BaseCtrl",["$rootScope","$scope","$window","$state","pb","pbui","$translate","$log","App_Dict","App_MenuData",function(a,c,b,d,f,k,m,h,l,n){var e=this;a.Dict=l;a.pbvar={};a.pbvar.ShowProcessing=!1;a.pbvar.ProcessingRect={};e.Lang="zh-cn";e.SetLang=function(a){e.Lang=a};a.$on("$stateChangeStart",function(a,b,c,d,e){f.AjaxNavRegister(b,c,d,e,!0);
k.PutProcessing("_view");k.PutProcessing(!1)});a.$on("$stateChangeError",function(a,b,c,d,e,f){a.preventDefault();f&&!1==f.isRcResult||h.error(f.stack);k.PutProcessing(!1)});a.$on("$stateChangeSuccess",function(a,b,c,d,p){e.SyncMenuToState(b);f.AjaxNavRegister(b,c,d,p);e.TranslateStateName(b);k.PutProcessing(!1)});e.TranslateStateName=function(a){null!=a.data.TranslatedName&&a.data.Lang==e.Lang||m(a.name).then(function(b){a.data.TranslatedName=b;a.data.Lang=e.Lang},function(){var b=a.name.split("/"),
c=b.length;m([b[c-1],b[c-2]]).then(function(d){a.data.TranslatedName=d[b[c-2]]+d[b[c-1]]})})};e.InitMenu=function(a){e.menuData=n;e.currentSubMenus=null;var b=a?a.toLowerCase():"";g.forEach(e.menuData,function(a,c){a.status=0<=b.indexOf(a.funcCode.toLowerCase())?"disabled":"";g.forEach(a.subMenus,function(c,f){var e=c.nav||"root";c.sref=c.stateParam?c.stateName+"({"+c.stateParam+',"ajax-nav":"'+e+'"})':c.stateName+'({"ajax-nav":"'+e+'"})';if(e=d.get(c.stateName))e.data.SubMenu=c,e.data.Menu=a;c.status=
0<=b.indexOf(c.funcCode.toLowerCase())?"disabled":""})})};e.SyncMenuToState=function(a){g.forEach(e.menuData,function(b,c){b.status||b!=a.data.Menu||(b.status="active",e.currentSubMenus=b.subMenus);"active"==b.status&&b!=a.data.Menu&&(b.status="");g.forEach(b.subMenus,function(b,c){b.status||b!=a.data.SubMenu||(b.status="active");"active"==b.status&&b!=a.data.SubMenu&&(b.status="")})})};e.test=function(a){b.alert("bingo")}}]);h.filter("Dict",["$filter","App_Dict",function(a,c){return function(a,d){var f=
c[d],k;for(k in f)if(f[k]==a)return k;return a}}]);h.filter("Display",["$filter","App_Dict",function(a,c){return function(b,d,f,k){if(g.isUndefined(b))return"";if(g.isNumber(b)&&d){if(g.isString(d))return a("Dict")(b,d);if(g.isNumber(d))return a("number")(b,d)}if(!0==b)return c.TrueDisplay;if(!1==b)return c.FalseDisplay;if(g.isString(b)&&f)return b.substring(f,k);g.isUndefined(d)&&(d="yyyy-MM-dd");return a("date")(b,d)}}]);h.filter("ReIndex",["$filter",function(a){return function(a,b){for(var d=a,
f=0;f<d;f++)g.isUndefined(b[f])&&(a-=1);return a}}]);h.directive("pbRequired",[function(){return{priority:1E4,restrict:"A",compile:function(a,c,b){"label"==c.pbRequired&&a.append("<span>&nbsp;*&nbsp;</span>")}}}]);h.directive("equalto",["$parse",function(a){return{restrict:"A",require:"ngModel",link:function(c,b,d,f){f.$validators.equalto=function(b,f){return(b||f)==a(d.equalto)(c)}}}}]);h.directive("maxByteLength",[function(){return{restrict:"A",require:"ngModel",link:function(a,c,b,d){d.$validators.maxByteLength=
function(a,c){var d=a||c;return""==d||d.getBytesLength()<=b.maxByteLength}}}}]);h.directive("unique",["pb","App_UniqueCheckerUri","$q",function(a,c,b){return{restrict:"A",require:"ngModel",link:function(d,f,g,h){h.$asyncValidators.unique=function(d,f){return a.AjaxSubmit(null,{value:d||f},{"ajax-url":c+g.unique}).then(function(a){return a.data?!0:b.reject()},function(){return b.reject()})}}}}]);l.prototype.endWith=function(a){return null==a||""==a||0==this.length||a.length>this.length?!1:this.substring(this.length-
a.length)==a?!0:!1};l.prototype.startWith=function(a){return null==a||""==a||0==this.length||a.length>this.length?!1:this.substr(0,a.length)==a?!0:!1};l.prototype.getBytesLength=function(){return this.replace(/[^\x00-\xff]/gi,"--").length};Date.prototype.Format=function(a){var c={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(a)&&(a=a.replace(RegExp.$1,(this.getFullYear()+
"").substr(4-RegExp.$1.length)));for(var b in c)RegExp("("+b+")").test(a)&&(a=a.replace(RegExp.$1,1==RegExp.$1.length?c[b]:("00"+c[b]).substr((""+c[b]).length)));return a}})(String,angular);
