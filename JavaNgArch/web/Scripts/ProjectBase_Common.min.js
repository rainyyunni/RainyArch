(function(l,h){var f=h.module("projectbase","ui.router ui.bootstrap jcs-autoValidate pascalprecht.translate ngCookies ngAnimate".split(" "));f.controller("BaseCtrl",["$rootScope","$scope","$window","$state","$transitions","pb","pbui","$translate","$log","App_Dict","App_MenuData","App_FuncTree",function(a,d,b,c,e,g,m,f,l,n,p,q){var k=this;a.Dict=n;a.pbvar={};a.pbvar.ShowProcessing=!1;a.pbvar.ProcessingRect={};f.onReady(function(){k.Lang=f.use()});k.SetLang=function(b){k.Lang=b};c.defaultErrorHandler(function(b){b&&
!1==b.isRcResult||l.error(b);m.PutProcessing(!1)});e.onStart({},function(b){g.AjaxNavRegister(b,!0);m.PutProcessing("_view");m.PutProcessing(!1)});e.onSuccess({},function(b){k.SyncMenuToState(b.to());g.AjaxNavRegister(b);k.TranslateStateName(b.to(),b.params());m.PutProcessing(!1)});k.TranslateStateName=function(b,a){if(null==b.data.TranslatedName||b.data.Lang!=k.Lang){var c=b.name,d=a.UrlTranslate;d&&(c=c+"?"+d);f(c).then(function(a){b.data.TranslatedName=a;b.data.Lang=k.Lang},function(){var a=b.name.split("/"),
c=a.length;f([a[c-1],a[c-2]]).then(function(d){b.data.TranslatedName=d[a[c-2]]+d[a[c-1]]})})}};k.InitMenu=function(b,a){k.forbiddenFuncList=b;k.menuData=a||p;k.currentSubMenus=null;var d=b?b.toLowerCase():"";h.forEach(k.menuData,function(b,a){b.status=0<=d.indexOf(b.funcCode.toLowerCase())?"disabled":"";h.forEach(b.subMenus,function(a,e){var g=a.nav||"root";a.sref=a.stateParam?a.stateName+"({"+a.stateParam+',"ajax-nav":"'+g+'"})':a.stateName+'({"ajax-nav":"'+g+'"})';if(g=c.get(a.stateName))g.data.SubMenu=
a,g.data.Menu=b;a.status=0<=d.indexOf(a.funcCode.toLowerCase())?"disabled":""})})};k.SyncMenuToState=function(b){h.forEach(k.menuData,function(a,c){a.status||a!=b.data.Menu||(a.status="active",k.currentSubMenus=a.subMenus);"active"==a.status&&a!=b.data.Menu&&(a.status="");h.forEach(a.subMenus,function(a,c){a.status||a!=b.data.SubMenu||(a.status="active");"active"==a.status&&a!=b.data.SubMenu&&(a.status="")})})};k.test=function(a){b.alert("bingo")}}]);f.constant("App_Dict",{});f.factory("App_FuncTree",
[function(){var a=null,d=!1;return{GetUncheckedListString:function(b){var a=[];h.forEach(b.funcList,function(d,g){!1!=b.selectedList[g]||!h.isUndefined(b.disableList[g])&&!1!=b.disableList[g]||a.push(d)});return a=a.join(",")},SetElementStatusByFunc:function(b,c){null!=a&&0>a.indexOf(","+c.toLowerCase()+",")||(d?b.prop("disabled",!0):b.css("display","none"))},SetForbiddenFuncList:function(b){a=b.toLowerCase()},SetForbiddenElementVisible:function(a){d=a}}}]);f.filter("Dict",["$filter","App_Dict",function(a,
d){return function(a,c){var e=d[c],g;for(g in e)if(e[g]==a)return g;return a}}]);f.filter("RefSelectEnforceMatch",["$filter","PBPlugIn",function(a,d){var b=null;return function(a,e){if(b)return b;if(d.RefListContainItem(a,e))return b=a;b=h.copy(a);b[a.length]=e;return b}}]);f.filter("SelectAddOptions",["$filter","PBPlugIn",function(a,d){var b=null;return function(a,e){if(b)return b;b=h.copy(a);if(!h.isObject(e)){var g=d.GetMoreOptionsDefault(),f;for(f in g)if(e==g[f]){e={};e[f]=g[f];break}}for(f in e)b[f]=
e[f];return b}}]);f.filter("Display",["$filter","App_Dict",function(a,d){return function(b,c,e,g){if(h.isUndefined(b))return"";if(h.isNumber(b)&&c){if(h.isString(c)&&d[c])return a("Dict")(b,c);if(h.isNumber(c))return a("number")(b,c)}if(!0==b)return d.TrueDisplay;if(!1==b)return d.FalseDisplay;if(h.isString(b)&&e)return b.substring(e,g);h.isUndefined(c)&&(c="yyyy-MM-dd");return a("date")(b,c)}}]);f.filter("ReIndex",["$filter",function(a){return function(a,b){for(var c=a,e=0;e<c;e++)h.isUndefined(b[e])&&
(a-=1);return a}}]);f.directive("pbRequired",[function(){return{priority:1E4,restrict:"A",compile:function(a,d,b){"label"==d.pbRequired&&a.append("<span>&nbsp;*&nbsp;</span>")}}}]);f.directive("pbValgroup",[function(){return{restrict:"A",require:"ngModel",link:function(a,d,b,c){c.pb_valgroup=b.pbValgroup}}}]);f.directive("pbEqualto",["$parse",function(a){return{restrict:"A",require:"ngModel",link:function(d,b,c,e){e.$validators.equalto=function(b,e){return(b||e)==a(c.pbEqualto)(d)}}}}]);f.directive("pbMaxByteLength",
[function(){return{restrict:"A",require:"ngModel",link:function(a,d,b,c){c.$validators.maxByteLength=function(a,d){var c=a||d;return""==c||c.getBytesLength()<=b.pbMaxByteLength}}}}]);l.prototype.endWith=function(a){return null==a||""==a||0==this.length||a.length>this.length?!1:this.substring(this.length-a.length)==a?!0:!1};l.prototype.startWith=function(a){return null==a||""==a||0==this.length||a.length>this.length?!1:this.substr(0,a.length)==a?!0:!1};l.prototype.getBytesLength=function(){return this.replace(/[^\x00-\xff]/gi,
"--").length};Date.prototype.Format=function(a){var d={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(a)&&(a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var b in d)RegExp("("+b+")").test(a)&&(a=a.replace(RegExp.$1,1==RegExp.$1.length?d[b]:("00"+d[b]).substr((""+d[b]).length)));return a}})(String,angular);
