(function(n,h){var f=h.module("projectbase");f.directive("pbDatepickerButton",[function(){var a=0;return{priority:0,restrict:"A",scope:!1,controllerAs:"_pbDatepickerButtonCtrl",controller:["$scope","$element","$attrs","$transclude",function(b,a,k,e){var d=this;d.open=function(b){d["pbtn"+b]={IsOpen:!0}}}],compile:function(b,c,k){"no"==c.pbDatepickerButton||b.parent().hasClass("input-group")||(a+=1,b.wrap("<div class='input-group'></div>").parent().append('<span class="input-group-btn"><a class="btn btn-default" ng-click="_pbDatepickerButtonCtrl.open('+
a+')"><i class="glyphicon glyphicon-calendar"></i></a>'),b.attr("is-open","_pbDatepickerButtonCtrl.pbtn"+a+".IsOpen"))}}}]);f.directive("pbCheckall",[function(){return{priority:0,template:'<input type="checkbox" ng-model="d.checked" ng-change="d.chkCheckAll_click()"/>',restrict:"E",scope:{listModel:"=listModel",selectedModel:"=selectedModel"},controllerAs:"d",controller:["$scope","$element","$attrs","$transclude",function(a,b,c,k){var e=this,d=c.listProp;e.allSelectedList=[];h.forEach(a.listModel,
function(b,a){e.allSelectedList[a]=b[d]});e.chkCheckAll_click=function(){a.selectedModel=e.checked?h.copy(e.allSelectedList):[]}}]}}]);f.directive("pbSortInput",["pb",function(a){return{priority:0,restrict:"A",scope:{sortModel:"=pbSortModel"},controllerAs:"d",controller:["$scope","$element","$attrs","$transclude",function(b,c,k,e){var d=this;d.inputName_Sort=k.pbSortInput;d.sortExpr=b.sortModel;d.submit=function(){b.sortModel=d.sortExpr;a.AjaxSubmit(c,null,{"ajax-data":d.inputName_Sort+"="+b.sortModel})}}],
compile:function(b,a,k){b.prepend('<input value="{{'+a.pbSortModel+'}}" type="hidden" name="'+a.pbSortInput+'" />')}}}]);f.directive("pbSortExpr",[function(){return{priority:0,require:"^pbSortInput",restrict:"A",scope:!1,compile:function(a,b,c){a.addClass("bg-warning");c=b.pbSortExpr;a.append('<span ng-class=\'pb_SortExpr.indexOf("desc")>0?"glyphicon glyphicon-triangle-bottom":"glyphicon glyphicon-triangle-top"\' ng-if=\'pb_SortExpr.indexOf("'+c+"\")>=0'></span>");null==b.pbSortAltExpr&&(0>c.indexOf(",")?
0<=c.toLowerCase().indexOf(" asc")?(b=c.split(" ")[0],a.attr("pb-sort-expr",b+" asc"),a.attr("pb-sort-altExpr",b+" desc")):0<=c.toLowerCase().indexOf(" desc")?(b=c.split(" ")[0],a.attr("pb-sort-expr",b+" desc"),a.attr("pb-sort-altExpr",b+" asc")):(a.attr("pb-sort-expr",c+" asc"),a.attr("pb-sort-altExpr",c+" desc")):a.attr("pb-sort-altExpr",c));return function(a,b,c,g){a.pb_SortExpr=g.sortExpr;b.bind("click",function(){var c=g.sortExpr,l=b.attr("pb-sort-expr"),d=b.attr("pb-sort-altExpr");g.sortExpr=
c!=l?l:d;g.submit();a.pb_SortExpr=g.sortExpr;return!1})}}}}]);f.directive("pbProcessingMask",[function(){return{priority:0,restrict:"E",compile:function(a,b,c){c=h.element('<div ng-style="$root.pbvar.ProcessingRect" ng-show="$root.pbvar.ShowProcessing"></div>');null==b["class"]&&c.addClass("projectbase-processing");c.append(a.children());a.append(c);return function(b,a,c){b.$root.pbvar.DefaultViewMaskId=c.targetid}}}}]);f.provider("pbui",function(){var a="../Scripts/tpl";this.SetTplPath=function(b){a=
b};this.$get=["$uibModal","$q","$translate","$uibPosition","$rootScope","$window","$log",function(b,c,f,e,d,g,h){return{Alert:function(c,d,e){return b.open({animation:e||!0,size:d,resolve:{msg:function(){return c}},templateUrl:a+"/pbui.Alert.htm",controller:["$scope","$uibModalInstance","msg",function(b,a,c){b.msg=c;b.ok=function(){a.close(!0)}}]}).result},Confirm:function(c,d,e,m){return b.open({animation:m||!0,size:e,resolve:{msg:function(){return c},msgParams:function(){return d}},templateUrl:a+
"/pbui.Confirm.htm",controller:["$scope","$uibModalInstance","msg","msgParams","$translate",function(b,a,c,d,l){l(c).then(function(a){b.msg=d?a.replace("{0}",d):a},function(a){b.msg=d?a.replace("{0}",d):a});b.msg=c;b.ok=function(){a.close(!0)};b.cancel=function(){a.dismiss(!1)}}]}).result},ShowCommand:function(c,d,e,m){return b.open({animation:m||!0,size:e,resolve:{msg:function(){return d}},templateUrl:a+"/pbui."+c+".htm",controller:["$scope","$uibModalInstance","msg",function(a,b,c){a.msg=c;a.ok=
function(){b.close(!0)}}]}).result},Dialog:function(a,c,d,e,f){return b.open({animation:f||!0,size:e,resolve:{paramObj:function(){return c}},templateUrl:a,controllerAs:"dc",controller:d}).result},PutProcessing:function(a){if(a){var b;"_view"==a&&(a=d.pbvar.DefaultViewMaskId);if(b=g.document.querySelector("#"+a)){a=e.position(b);d.pbvar.ProcessingRect.width=a.width+"px";d.pbvar.ProcessingRect.height=30<a.height?a.height+"px":"50px";for(var c=0,f=0;"HTML"!=b.tagName;)a=e.position(b),f+=a.left,c+=a.top,
b=e.offsetParent(b);d.pbvar.ProcessingRect.top=c+"px";d.pbvar.ProcessingRect.left=f+"px";d.pbvar.ShowProcessing=!0}else d.pbvar.ShowProcessing=!1,h.error("no element for "+a)}else d.pbvar.ShowProcessing=!1}}}]})})(String,angular);
