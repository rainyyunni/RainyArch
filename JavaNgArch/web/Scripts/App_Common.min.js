var app=angular.module("app",["projectbase"]),def=new PB_Global_StateDefiner(app);def.SetDefaultLayout("/Shared/ContentLayout");def.SetAjaxNavRootState("/home/Home/MainFrameLoggedIn");def.SetUrlContextPrefix("");def.SetUrlMappingPrefix("/do");def.LayoutState("/Shared/ContentLayout.htm");def.LayoutState("/Shared/ErrorLayout.htm");app.constant("App_DefaultState","/home/Home/ShowLogin");app.constant("App_UniqueCheckerUri","/do/shared/Common/CheckUnique?name=");app.constant("APP_ContextPrefix","");
app.config(["$stateProvider","$urlRouterProvider","$httpProvider","$translateProvider","pbProvider","pbuiProvider","App_DefaultState","APP_ContextPrefix",function(b,c,a,d,g,f,e,h){a.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded";d.useSanitizeValueStrategy("escape");d.useLocalStorage();d.preferredLanguage(window.localStorage.lang||"zh-cn");d.useStaticFilesLoader({prefix:h+"/Scripts/lang/",suffix:".json"});c.otherwise(e);
def.RegisterStates(b);f.SetTplPath(h+"/Scripts/tpl")}]);app.run(["validator","myCustomErrorMessageResolver","myCustomElementModifier","defaultErrorMessageResolver","App_FuncTree","APP_ContextPrefix",function(b,c,a,d,g,f){b.registerDomModifier(a.key,a);b.setDefaultElementModifier(a.key);b.defaultFormValidationOptions.forceValidation=!0;d.setI18nFileRootPath(f+"/Scripts/lang");d.setCulture("zh-cn");b.setErrorMessageResolver(c.resolve);g.SetForbiddenElementVisible(!0)}]);
app.factory("myCustomErrorMessageResolver",["$q","defaultErrorMessageResolver","$translate","$window","$log",function(b,c,a,d,g){return{resolve:function(b,e){var h=c.resolve(b,e),l;if(e.attr("pb-valmsg"))try{l=angular.fromJson(e.attr("pb-valmsg"))[b]}catch(m){g.error("pb-valmsg's value is invalid, should be a json string:"+e.attr("pb-valmsg"))}var k=e.attr("translatekey");return h.then(function(b){var c=l||b;a([k,c]).then(function(a){d.alert(a[k]+" "+a[c])},function(a){d.alert(a[k]+" "+a[c])})})}}}]);
app.factory("myCustomElementModifier",[function(){return{makeValid:function(b){b.css("border-color","green")},makeInvalid:function(b,c){b.css("border-color","red")},makeDefault:function(b){b.css("border-color","blue")},key:"myCustomModifierKey"}}]);
app.factory("PBPlugIn",["PBPlugIn_Default","$window",function(b,c){var a={};angular.extend(a,b);a.ShowResultMessage=function(a){c.alert('coding here for your own global method "ShowMessage" with msgKey='+a)};a.RefListContainItem=function(a,b){for(var c=0;c<a.length;c++)if(a[c].id==b.id)return!0;return!1};a.GetMoreOptionsDefault=function(){return{"\u5168\u90e8":-1}};return a}]);
app.factory("App_FuncTree",[function(){var b=null,c=!1;return{GetUncheckedListString:function(a){var b=[];angular.forEach(a.funcList,function(c,f){!1!=a.selectedList[f]||!angular.isUndefined(a.disableList[f])&&!1!=a.disableList[f]||b.push(c)});return b=b.join(",")},SetElementStatusByFunc:function(a,d){null!=b&&0>b.indexOf(","+d.toLowerCase()+",")||(c?a.prop("disabled",!0):a.css("display","none"))},SetForbiddenFuncList:function(a){b=a.toLowerCase()},SetForbiddenElementVisible:function(a){c=a}}}]);
app.directive("appUnique",["pb","App_UniqueCheckerUri","$q",function(b,c,a){return{restrict:"A",require:"ngModel",link:function(d,g,f,e){e.$asyncValidators.unique=function(d,e){return b.AjaxSubmit(null,{value:d||e},{"ajax-url":c+f.appUnique}).then(function(b){return b.data?!0:a.reject()},function(){return a.reject()})}}}}]);
